<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mycompany.miniproject.dao.ProductDAO">

	<select id="selectNewProduct" resultType="Product" >
		<![CDATA[
			SELECT
				product_id,
				product_name,
				product_price,
				product_datetime
			FROM 
				(SELECT
					product_id,
					product_name,
					product_price,
					product_datetime
				FROM 
					PRODUCT
				ORDER BY product_datetime DESC, product_name)
			WHERE
				rownum <= 8
		]]>
	</select>
	
	<select id="selectBestProduct" resultType="Product">
		<![CDATA[
			SELECT 
				product_id, 
				product_name, 
				product_price, 
				order_product_count
			FROM (
			    SELECT 
			    		p.product_id, 
			    		p.product_name, 
			    		p.product_price, 
			    		op.order_product_count
			    FROM 
			    		order_product op
			    LEFT OUTER JOIN 
			    		product p
			    ON 
			    		p.product_id = op.product_id
			    ORDER BY 
			    		op.order_product_count DESC
			)
				WHERE 
					rownum <= 8
		]]>
		
	</select>
	
	<select id="selectRecomProduct" resultType="Product">
	    <![CDATA[
	        SELECT product_id, 
	                product_name, 
	                product_price
	        FROM (
	            SELECT 
	                product_id, 
	                product_name, 
	                product_price
	            FROM 
	                product
	            WHERE 
	                product_recom = 1
	        )
	        WHERE rownum <= 8
	    ]]>
	</select>
	
	<select id="selectAll" parameterType="Pager" resultType="Product">
	    <![CDATA[
	        SELECT
	            product_id, 
	            product_name, 
	            product_price,
	            category_name
	        FROM (
	            SELECT rownum as rnum, 
	                product_id, 
	                product_name, 
	                product_price,
	                category_name
	            FROM (
	                SELECT
	                    product_id, 
	                    product_name, 
	                    product_price,
	                    category_name
	                FROM PRODUCT
	    ]]>
	    <if test="categoryName != null and categoryName != ''">
	        WHERE category_name = #{categoryName}
	    </if>
	    <![CDATA[
	                ORDER BY product_id
	            )
	            WHERE rownum <= #{endRowNo}
	        )
	        WHERE rnum >= #{startRowNo}
	    ]]>
	</select>
	
	
	
	<select id="countProduct" parameterType="String" resultType="int">
	    SELECT
	        COUNT(*)
	    FROM
	        PRODUCT
	    <if test="categoryName != null and categoryName != ''">
	        WHERE category_name = #{categoryName}
	    </if>	
	</select>
	
	<select id="totalRows"  resultType="int">
		SELECT
			count(product_id)
		FROM
			PRODUCT
	</select>
	
	<select id="selectProductDetail" parameterType="int" resultType="Product" >
		SELECT 
		    product_id, 
		    product_name, 
		    product_price
		FROM 
			PRODUCT
		WHERE 
			product_id = #{productId}
	</select>

	<insert id="insertProduct" parameterType="Product">
		<![CDATA[
			INSERT INTO PRODUCT(
				product_id,
				product_name,
				category_name,
				product_price,
				product_datetime,
				product_detail,
				product_state,
				product_stock,
				product_recom,
				product_new,
				product_best
			) VALUES (
				seq_product_id.nextval,
				#{productName},
				#{categoryName},
				#{productPrice},
				sysdate,
				#{productDetail},
				#{productState},
				#{productStock},
				#{productRecom},
				0,
				0
			)
		]]>
	</insert>
	
	<select id="selectRecentProductId" parameterType="String" resultType="Product">
		SELECT product_id
		FROM PRODUCT
		WHERE product_name = #{productName}
		ORDER BY product_id DESC
		FETCH FIRST 1 ROWS ONLY
	</select>
	
	<select id="selectAllProductList" parameterType="Pager" resultType="Product" >
		<![CDATA[
			SELECT
				product_id,
				product_name,
				product_price,
				product_datetime,
				product_detail,
				product_state,
				product_stock,
				product_recom,
				category_name,
				product_new,
				product_best
			FROM
				(SELECT
					rownum as rnum,
					product_id,
					product_name,
					product_price,
					product_datetime,
					product_detail,
					product_state,
					product_stock,
					product_recom,
					category_name,
					product_new,
					product_best
				FROM
					(SELECT
						product_id,
						product_name,
						product_price,
						product_datetime,
						product_detail,
						product_state,
						product_stock,
						product_recom,
						category_name,
						product_new,
						product_best
					FROM PRODUCT
					ORDER BY product_id)
				WHERE rownum <= #{endRowNo})
			WHERE rnum >= #{startRowNo}
			
		]]>
	</select>
	
	<select id="selectProductAllCount" resultType="int" >
		SELECT COUNT(*)
		FROM PRODUCT
	</select>
	
	<update id="updateProduct" parameterType="Product" >
		<![CDATA[
			UPDATE PRODUCT
			SET 
				product_name = #{productName},
				product_price = #{productPrice},
				product_detail = #{productDetail},
				product_state = #{productState},
				product_stock = #{productStock},
				product_recom = #{productRecom},
				category_name = #{categoryName}
			WHERE
				product_id = #{productId}
		]]>	
	</update>
	
	<delete id="deleteProduct" parameterType="Product" >
		<![CDATA[
			DELETE FROM PRODUCT
			WHERE product_id = #{productId}
		]]>
	</delete>

</mapper>